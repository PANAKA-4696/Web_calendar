PHPシンプルカレンダー＆イベントマネージャー
このドキュメントは、PHPとPDO（PHP Data Objects）を使用して構築された、シンプルなウェブベースのカレンダーおよびイベント管理アプリケーションについて説明します。このアプリケーションは、カレンダーの表示、特定の日付のイベント追加、既存イベントの表示/削除などの機能を提供します。

1. アプリケーション概要
本アプリケーションは、ユーザーが日付を選択し、その日にイベントを追加したり、既存のイベントを表示・削除したりできる基本的なカレンダー機能を提供します。ファイルのアップロード機能も含まれており、イベントに関連するファイルを添付することができます。

2. 機能一覧
カレンダー表示: 月間カレンダーを表示し、前月および次月へのナビゲーションが可能です。

祝日表示: 固定の日本の祝日（例: 元日、建国記念の日、天皇誕生日など）をカレンダー上でハイライトし、名称を表示します。春分の日、海の日など、年によって日付が変動する祝日は計算で導き、週や、曜日などで計算することが出来ました。

イベント追加: 特定の日付に対して、開始時間、終了時間、予定内容（必須）、場所、URL、添付ファイル、メモなどの情報を入力して新しいイベントを追加できます。

イベント一覧表示: 選択した日付の全イベントを時系列順に一覧表示します。各イベントの詳細は、予定番号、開始時間、終了時間、予定内容、場所、URL、ファイル、メモを含みます。

イベント削除: 一覧から個別のイベントを削除できます。関連する添付ファイルも同時に削除されます。

ファイルアップロード: イベント作成時にファイルを1つ添付し、サーバーの指定されたディレクトリに保存できます。

入力検証: 必須フィールド（開始時間、予定内容）の入力チェックや、URL形式の検証など、基本的な入力検証が行われます。

3. 使用技術
PHP: バックエンドのロジック処理に用いられます。

PDO (PHP Data Objects): MySQLデータベースとの安全なやり取りのために使用されます。プリペアドステートメントによりSQLインジェクション対策が施されています。

HTML5: ウェブページの構造を定義します。

CSS3: style.css を通じてページのデザインとレイアウトを制御します。Bootstrapも併用されています。

Bootstrap 3.3.7: レスポンシブデザインとUIコンポーネント（グリッドシステム、テーブル、フォーム部品など）を提供します。

4. セットアップ手順
4.1. データベース設定
データベースの作成:
calendar_DB という名前のMySQLデータベースを作成します。これは db_define.php で定義されるデータベース名と一致する必要があります。

    CREATE DATABASE calendar_DB CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

テーブルの作成:
plan という名前のテーブルを作成します。このテーブルはイベント情報を保存するために使用されます。

    CREATE TABLE `plan` (
        `id` INT(11) NOT NULL AUTO_INCREMENT,
        `date` DATE NOT NULL,
        `before_time` TIME NOT NULL,
        `after_time` TIME DEFAULT NULL,
        `content` VARCHAR(255) NOT NULL,
        `place` VARCHAR(255) DEFAULT NULL,
        `url` VARCHAR(255) DEFAULT NULL,
        `file` VARCHAR(255) DEFAULT NULL,
        `memo` TEXT DEFAULT NULL,
        `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (`id`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

データベースユーザーの作成と権限付与:
アプリケーションがデータベースに接続するための専用ユーザーを作成し、必要な権限を付与します。例として calendar_user を作成します。

    CREATE USER 'calendar_user'@'localhost' IDENTIFIED BY 'calendarpass';
    GRANT ALL PRIVILEGES ON calendar_DB.* TO 'calendar_user'@'localhost';
    FLUSH PRIVILEGES;

(注: calendarpass はより強力なパスワードに変更することを推奨します。)

4.2. db_define.php の設定
db_define.php ファイルを開き、データベース接続情報を環境に合わせて設定します。

    <?php
    define("DBNAME","calendar_DB"); // データベース名
    define("DBHOST","localhost");    // データベースホスト
    define("DBPORT","3307");         // データベースポート (デフォルトは3306の場合が多いです)
    define("DBUSER","calendar_user"); // データベースユーザー名
    define("DBPASS","calendarpass"); // データベースパスワード

4.3. ファイルの配置
提供されたすべてのPHPファイル (index.php, plan.php, confirm.php, complete.php, plan_table.php, delete.php, db_define.php) と style.css ファイルを、使用しているウェブサーバーのドキュメントルートディレクトリ（例: Apacheの htdocs、Nginxの www、XAMPP/MAMPの htdocs）に配置します。

また、ファイルアップロード機能のために、PHPファイルと同じ階層に uploads/ ディレクトリを作成し、ウェブサーバーから書き込み可能な権限（例: chmod 755 uploads/ または chmod 777 uploads/ - ただし 777 はセキュリティリスクがあるため本番環境では避けるべきです）を設定してください。

    your_web_root/
    ├── index.php
    ├── plan.php
    ├── confirm.php
    ├── complete.php
    ├── plan_table.php
    ├── delete.php
    ├── db_define.php
    ├── style.css
    └── uploads/  (ウェブサーバーから書き込み可能に設定)

4.4. アプリケーションへのアクセス
ウェブブラウザから、配置した index.php ファイルのURLにアクセスします。

例:
http://localhost/index.php
または
http://your_domain/index.php

5. ページ構成とフロー
5.1. index.php (カレンダーページ)
アプリケーションのトップページです。

現在の月のカレンダーを表示します。

「<」と「>」のリンクで前月・次月に移動できます。

各日付セルには、「追加」リンクと「予定」リンクがあります。

「追加」をクリックすると、その日付の plan.php (予定追加フォーム) に遷移します。

「予定」をクリックすると、その日付の plan_table.php (予定一覧) に遷移します。

日本の固定祝日（元日、建国記念の日など）が表示され、ハイライトされます。

5.2. plan.php (予定追加フォーム)
index.php から日付を選択して遷移します。

選択された日付がフォームのタイトルに表示されます。

開始時間、終了時間、予定内容、場所、URL、ファイル、メモを入力するフォームを提供します。

「確認画面へ」ボタンで confirm.php にデータをPOSTします。

入力検証エラーがあった場合、confirm.php からリダイレクトされ、エラーメッセージが表示されます。

「カレンダーページに戻る」リンクで index.php に戻ることができます。

5.3. confirm.php (入力内容確認画面)
plan.php からPOSTされたデータを受け取り、セッションに保存します。

必須フィールド（開始時間、予定内容）の入力チェックやURL形式の検証を行います。

バリデーションエラーがある場合、エラーメッセージをセッションに保存し、plan.php にリダイレクトしてエラーを表示します。

入力内容の一覧を表示します。

「修正する」ボタンで plan.php に戻り、入力内容を修正できます。

「この内容で登録する」ボタンで complete.php に遷移し、データベースにデータを登録します。

5.4. complete.php (登録完了画面)
confirm.php からの遷移を受け、セッションに保存されたデータを使用してデータベースに予定を登録します。

ファイルがアップロードされている場合、一時ファイルから uploads/ ディレクトリに移動し、ファイルパスをデータベースに保存します。

登録完了後、セッションデータをクリアします。

登録完了のメッセージを表示し、「カレンダーページに戻る」ボタンで index.php に戻ることができます。

5.5. plan_table.php (予定一覧表示画面)
index.php から日付を選択して遷移します。

指定された日付のすべての予定をデータベースから取得し、時系列順に表示します。

各予定には、予定番号、開始時間、終了時間、予定内容、場所、URL、ファイル（ダウンロードリンク）、メモが表示されます。

各予定の下部には「この予定を削除」ボタンがあり、クリックすると確認ダイアログが表示され、承諾すると delete.php にPOSTで削除リクエストを送信します。

「この日に新しい予定を追加する」ボタンで plan.php に遷移し、新しい予定を追加できます。

「カレンダーページに戻る」リンクで index.php に戻ることができます。

5.6. delete.php (予定削除処理)
plan_table.php からPOSTされた予定のIDと日付を受け取ります。

指定されたIDの予定をデータベースから削除します。

関連するファイルパスがデータベースに保存されている場合、該当するファイルもサーバーから削除します。

削除の成否メッセージを表示し、「予定一覧に戻る」または「カレンダーページに戻る」ボタンでそれぞれのページに遷移できます。

不正なIDが指定された場合はエラーを処理します。

6. CSS (style.css)
アプリケーションの全体的なスタイリングを制御します。

基本的なフォント、色、マージン、パディングの設定。

カレンダーのレイアウト、日付の表示、祝日のハイライト、土日祝日の色分け。

フォーム、確認画面、完了/削除画面、予定一覧の各セクションのスタイリング。

ボタン、リンク、エラーメッセージのスタイル。

7. 注意事項と今後の改善点
セキュリティの強化:

本アプリケーションは基本的な機能を提供しており、本番環境での使用にはさらなるセキュリティ対策が必要です。

より詳細な入力値のサニタイズ（XSS対策など）とバリデーションをすべての入力に対して実施することを推奨します。

CSRF（クロスサイトリクエストフォージェリ）対策として、トークンを導入することを推奨します。

エラーメッセージはユーザーに詳細を表示せず、ログに記録するべきです。

ファイルアップロードに関するセキュリティ（悪意のあるファイルのアップロード防止、ファイルタイプ・サイズ制限、ファイル名のランダム化など）を強化する必要があります。

祝日計算: 現在、変動する祝日（例: 春分の日、海の日、敬老の日など）はカレンダーに表示されません。正確な祝日表示のためには、祝日計算ライブラリの導入やより複雑なロジックが必要です。

エラーハンドリング: データベース接続エラーやクエリ実行エラーなど、ユーザーフレンドリーなエラーメッセージと適切なエラーロギングを実装することが望ましいです。

UI/UXの改善:

Bootstrap 3.3.7は古いバージョンであるため、最新のBootstrap 5などへのアップデートを検討すると、よりモダンでアクセスしやすいUI/UXを提供できます。

JavaScript/Ajaxを利用して、ページ遷移なしでイベントの追加や表示を行うことで、ユーザー体験を向上させることができます。

機能拡張:

イベントの編集機能。

イベントのリマインダー機能。

複数ファイルのアップロード。

ユーザー管理機能。

検索・フィルター機能。
![スクリーンショット 2025-07-09 001000](https://github.com/user-attachments/assets/e633b76c-1778-4893-bb92-dfa5acb90533)
![スクリーンショット 2025-07-09 000954](https://github.com/user-attachments/assets/ee5f2e54-823f-4b9e-b19c-7e4ff458a4a4)
![スクリーンショット 2025-07-09 000946](https://github.com/user-attachments/assets/bc1cdd61-bf7d-4e9f-b612-e38f3807ab7a)
![スクリーンショット 2025-07-09 000936](https://github.com/user-attachments/assets/3bd0cfb0-063c-448d-a1d0-4906a3ff5a3c)
![スクリーンショット 2025-07-09 000130](https://github.com/user-attachments/assets/dc784b5e-bcef-4e3e-a983-421bd0afcb09)
![スクリーンショット 2025-07-09 000038](https://github.com/user-attachments/assets/f12a0b5d-9ba4-406c-9ebd-a310e6cc81c0)
![スクリーンショット 2025-07-09 000038 - コピー](https://github.com/user-attachments/assets/afb4db70-9892-487b-97ac-978f970ae760)

